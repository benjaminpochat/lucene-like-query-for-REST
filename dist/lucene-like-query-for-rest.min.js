var CONTITION_TYPE_SIMPLE_EQUAL="CONTITION_TYPE_SIMPLE_EQUAL",CONTITION_TYPE_GREATER_OR_EQUAL="CONTITION_TYPE_GREATER_OR_EQUAL",CONTITION_TYPE_LOWER_OR_EQUAL="CONTITION_TYPE_LOWER_OR_EQUAL",CONTITION_TYPE_MULTI_VALUE="CONTITION_TYPE_MULTI_VALUE",CONTITION_TYPE_EQUAL_WITH_WHITESPACES="CONTITION_TYPE_EQUAL_WITH_WHITESPACES",CONTITION_TYPE_RANGE="CONTITION_TYPE_RANGE",Attribute=function(){this.naturalName=null,this.possibleValues=null,this.mappedValues=null,this.restAPIUrl=null,this.restMapperCallback=null,this.authorizedConditionTypes=null},Completer=function(a){this.attributes=a,this.parser=new Parser,this.getPossibleCompletedQueries=function(a){return this.parser.isLastTokenAttributeName(a)?this.getMatchingAttributes(a):this.getMatchingValues(a)},this.getMatchingAttributes=function(a){var b=this.parser.getLastConditionCurrentlyTyped(a),c=this.getAttributeNames();return $.ui.autocomplete.filter(c,b)},this.getMatchingAttributesPatterns=function(a){return null},this.getMatchingValues=function(a){var b,c=this.parser.getLastConditionCurrentlyTyped(a),d=c.indexOf(":"),e=c.substring(0,d);if(c.indexOf(",")>0){var f=c.lastIndexOf(",");b=c.substring(f+1)}else b=c.substring(d+1);var g=this.getPossibleValues(e);return void 0===g?null:$.ui.autocomplete.filter(g,b)},this.getPossibleValues=function(a){var b=this.getAttribute(a);return void 0!==b.restAPIUrl?this.getPossibleValuesFromRestAPI(b):void 0!==b.possibleValues?this.getPossibleValuesFromTableOfValues(b):void 0},this.getPossibleValuesFromTableOfValues=function(a){if(a.mappedValues){for(var b=[],c=0;c<a.possibleValues.length;)b[c]=a.possibleValues[c].value,c++;return b}return a.possibleValues},this.getPossibleValuesFromRestAPI=function(a){var b=null;return $.ajax({url:a.restAPIUrl,context:document.body,async:!1,success:function(c){b=c.map(a.restMapperCallback)}}),b},this.getAttributeNames=function(){var b=new Array(a.length);for(i=0;i<a.length;i++)b[i]=a[i].naturalName;return b},this.getAttribute=function(b){for(i=0;i<a.length;i++)if(a[i].naturalName==b)return a[i]},this.complete=function(a,b){var c="",d=this.parser.splitConditions(a),e=this.parser.getLastConditionCurrentlyTyped(a);if(null!==d){var f=d.length;for(d[f-1]==e&&(f-=1),i=0;i<f;i++)c+=d[i]+" "}var g="";return g=this.parser.isLastTokenAttributeName(a)?c+b.label+":":e.indexOf(",")>0?this.completeMultiValueFilter(c,e,b):this.completeSimpleValueFilter(c,e,b)},this.completeSimpleValueFilter=function(a,b,c){var d="",e=b.indexOf(":"),f=b.substring(0,e+1),g=(b.indexOf(",")>0,c.label.indexOf(" ")>0);return d=g?a+f+'"'+c.label+'" ':a+f+c.label+" "},this.completeMultiValueFilter=function(a,b,c){var d="",e=b.lastIndexOf(","),f=b.substring(0,e+1),g=c.label.indexOf(" ")>0;return d=g?a+f+'"'+c.label+'" ':a+f+c.label+" "}},Converter=function(a,b,c){this.destinationFormat=void 0===c?ODATA:c,this.restTokenBuilder=new RestTokenBuilder(this.destinationFormat),this.attributes=b,this.parser=new Parser,this.convert=function(){var b=$(a).val();return this.convertNaturalQuery(b)},this.convertNaturalQuery=function(a){for(var b=this.parser.splitConditions(a),c="",d=0;d<b.length;d++)c=0===d?this.convertNaturalCondition(b[d]):c+this.restTokenBuilder.getAndRestToken()+this.convertNaturalCondition(b[d]);return c},this.convertNaturalCondition=function(a){return a.match(this.parser.buildConditionRegExp(this.parser.SIMPLE_EQUAL_PATTERN))?this.convertSimpleEqualCondition(a):a.match(this.parser.buildConditionRegExp(this.parser.EQUAL_WITH_WHITE_SPACE_PATTERN))?this.convertEqualConditionWhiteSpace(a):a.match(this.parser.buildConditionRegExp(this.parser.MULTI_VALUE_PATTERN))?this.convertMultiValueCondition(a):a.match(this.parser.buildConditionRegExp(this.parser.GREATER_OR_EQUAL_PATTERN))?this.convertGreaterOrEqualThanCondition(a):a.match(this.parser.buildConditionRegExp(this.parser.LOWER_OR_EQUAL_PATTERN))?this.convertLowerOrEqualThanCondition(a):a.match(this.parser.buildConditionRegExp(this.parser.RANGE_PATTERN))?this.convertRangeCondition(a):void 0},this.convertSimpleEqualCondition=function(a){return this.convertSimpleCondition(a,":",this.restTokenBuilder.getEqualRestToken())},this.convertGreaterOrEqualThanCondition=function(a){return this.convertSimpleCondition(a,">",this.restTokenBuilder.getGreaterOrEqualRestToken())},this.convertLowerOrEqualThanCondition=function(a){return this.convertSimpleCondition(a,"<",this.restTokenBuilder.getLowerOrEqualRestToken())},this.convertSimpleCondition=function(a,b,c){var d=a.indexOf(b),e=a.substring(0,d),f=a.substring(d+1),g=this.getRestValue(e,f);return e+c+g},this.getAttribute=function(a){if(void 0===this.attributes||null===this.attributes)return null;for(i=0;i<this.attributes.length;i++)if(this.attributes[i].naturalName==a)return this.attributes[i]},this.getRestValue=function(a,b){var c,d=this.getAttribute(a);if(void 0===d||null===d)c=b;else if(d.mappedValues)for(i=0;i<d.possibleValues.length;i++)d.possibleValues[i].value==b&&(c=d.possibleValues[i].key);else c=b;return this.restTokenBuilder.getStringDelimiterRestToken()+c+this.restTokenBuilder.getStringDelimiterRestToken()},this.convertMultiValueCondition=function(a){for(var b=a.indexOf(":"),c=a.substring(0,b),d=a.substring(b+1).split(","),e=this.restTokenBuilder.getLeftParenthesisRestToken(),f=0;f<d.length;f++)f>0&&(e+=this.restTokenBuilder.getOrRestToken()),e+=c+this.restTokenBuilder.getEqualRestToken()+this.restTokenBuilder.getStringDelimiterRestToken()+d[f]+this.restTokenBuilder.getStringDelimiterRestToken();return e+=this.restTokenBuilder.getRightParenthesisRestToken()},this.convertEqualConditionWhiteSpace=function(a){var b=a.indexOf(":"),c=a.substring(0,b),d=a.substring(b+2);d=d.substring(0,d.length-1);var e=c+this.restTokenBuilder.getEqualRestToken()+this.getRestValue(c,d);return e},this.convertRangeCondition=function(a){var b=a.indexOf(":"),c=a.substring(0,b),d=a.substring(b+2);d=d.substring(0,d.length-1);var e=d.split(" "),f=c+this.restTokenBuilder.getGreaterOrEqualRestToken()+this.restTokenBuilder.getStringDelimiterRestToken()+e[0]+this.restTokenBuilder.getStringDelimiterRestToken()+this.restTokenBuilder.getAndRestToken()+c+this.restTokenBuilder.getLowerOrEqualRestToken()+this.restTokenBuilder.getStringDelimiterRestToken()+e[1]+this.restTokenBuilder.getStringDelimiterRestToken();return f}},NaturalQuery=function(a,b,c){return new NaturalQueryProcessor(a,b,c)},NaturalQueryProcessor=function(a,b,c){var d=new Completer(b);this.process=function(){var d=this.getPossibleValues,e=this.updateValueAfterSelect;return $(function(){$(a).autocomplete({position:{my:"right top",at:"right bottom"},source:d,select:e,focus:function(){return!1}})}),new Converter(a,b,c)},this.getPossibleValues=function(a,b){console.log("typed data = "+a.term),possibleValues=d.getPossibleCompletedQueries(a.term),b(possibleValues)},this.updateValueAfterSelect=function(b,c){var e=d.complete(this.value,c.item);return $(a).val(e),!1}},Parser=function(){this.SIMPLE_EQUAL_PATTERN='(\\w+):([^,\\"\\[\\] ]+)',this.GREATER_OR_EQUAL_PATTERN='(\\w+)>([^,\\"\\[\\] ]+)',this.LOWER_OR_EQUAL_PATTERN='(\\w+)<([^,\\"\\[\\] ]+)',this.MULTI_VALUE_PATTERN='(\\w+):(([^,\\"\\[\\] ]+)|(\\"[^\\"]+\\"))((,(([^,\\"\\[\\] ]*)|(\\"[^\\"]+\\")*)+)*)',this.EQUAL_WITH_WHITE_SPACE_PATTERN='(\\w+):(\\"[^\\"]+\\")',this.RANGE_PATTERN="(\\w+):(\\[[^\\[\\]]+\\])",this.buildNaturalQueryRegExp=function(){return new RegExp("("+this.MULTI_VALUE_PATTERN+")|("+this.SIMPLE_EQUAL_PATTERN+")|("+this.GREATER_OR_EQUAL_PATTERN+")|("+this.LOWER_OR_EQUAL_PATTERN+")|("+this.EQUAL_WITH_WHITE_SPACE_PATTERN+")|("+this.RANGE_PATTERN+")","g")},this.buildConditionRegExp=function(a){return new RegExp("^"+a+"$","g")},this.splitConditions=function(a){var b=this.buildNaturalQueryRegExp(),c=a.match(b);return c},this.isLastTokenAttributeName=function(a){var b=this.getLastConditionCurrentlyTyped(a);return!b.match(/(.+):(.*)/)},this.getLastConditionCurrentlyTyped=function(a){var b=this.splitConditions(a),c=a;if(null!==b)for(i=0;i<b.length;i++)c=c.replace(/^\s+/,""),c=c.replace(b[i],"");return"undefined"!==c&&""!==c||null===b||(c=b[b.length-1]),void 0===c?c:c.trim()}};const ODATA="ODATA",FIQL="FIQL";var RestTokenBuilder=function(a){this.destinationFormat=a,this.getEqualRestToken=function(){switch(this.destinationFormat){case ODATA:return" eq ";case FIQL:return"=="}return null},this.getGreaterOrEqualRestToken=function(){switch(this.destinationFormat){case ODATA:return" ge ";case FIQL:return"=ge="}return null},this.getLowerOrEqualRestToken=function(){switch(this.destinationFormat){case ODATA:return" le ";case FIQL:return"=le="}return null},this.getAndRestToken=function(){switch(this.destinationFormat){case ODATA:return" and ";case FIQL:return";"}return null},this.getOrRestToken=function(){switch(this.destinationFormat){case ODATA:return" or ";case FIQL:return","}return null},this.getStringDelimiterRestToken=function(){switch(this.destinationFormat){case ODATA:return"'";case FIQL:return""}return null},this.getLeftParenthesisRestToken=function(){switch(this.destinationFormat){case ODATA:return"( ";case FIQL:return"("}return null},this.getRightParenthesisRestToken=function(){switch(this.destinationFormat){case ODATA:return" )";case FIQL:return")"}return null}};
//# sourceMappingURL=lucene-like-query-for-rest.min.js.map