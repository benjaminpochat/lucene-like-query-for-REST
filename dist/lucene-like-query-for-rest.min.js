var CONTITION_TYPE_SIMPLE_EQUAL="CONTITION_TYPE_SIMPLE_EQUAL",CONTITION_TYPE_GREATER_OR_EQUAL="CONTITION_TYPE_GREATER_OR_EQUAL",CONTITION_TYPE_LOWER_OR_EQUAL="CONTITION_TYPE_LOWER_OR_EQUAL",CONTITION_TYPE_MULTI_VALUE="CONTITION_TYPE_MULTI_VALUE",CONTITION_TYPE_EQUAL_WITH_WHITESPACES="CONTITION_TYPE_EQUAL_WITH_WHITESPACES",CONTITION_TYPE_RANGE="CONTITION_TYPE_RANGE",Attribute=function(){this.naturalName=null,this.possibleValues=null,this.mappedValues=null,this.restAPIUrl=null,this.restMapperCallback=null,this.authorizedConditionTypes=null},Completer=function(a){function b(a){var b=l.getLastConditionCurrentlyTyped(a),c=j();return $.ui.autocomplete.filter(c,b)}function c(a){var b,c=l.getLastConditionCurrentlyTyped(a),e=c.indexOf(":"),f=c.substring(0,e);if(c.indexOf(",")>0){var g=c.lastIndexOf(",");b=c.substring(g+1)}else b=c.substring(e+1);var h=d(f);return void 0===h?null:$.ui.autocomplete.filter(h,b)}function d(a){var b=k(a);return void 0!==b.restAPIUrl?f(b):void 0!==b.possibleValues?e(b):void 0}function e(a){if(a.mappedValues){for(var b=[],c=0;c<a.possibleValues.length;)b[c]=a.possibleValues[c].value,c++;return b}return a.possibleValues}function f(a){var b=null;return $.ajax({url:a.restAPIUrl,context:document.body,async:!1,success:function(c){b=c.map(a.restMapperCallback)}}),b}function g(a,b,c){var d="",e=b.indexOf(":"),f=b.substring(0,e+1),g=(b.indexOf(",")>0,c.label.indexOf(" ")>0);return d=g?a+f+'"'+c.label+'" ':a+f+c.label+" "}function h(a,b,c){var d="",e=b.lastIndexOf(","),f=b.substring(0,e+1),g=c.label.indexOf(" ")>0;return d=g?a+f+'"'+c.label+'" ':a+f+c.label+" "}function j(){var b=new Array(a.length);for(i=0;i<a.length;i++)b[i]=a[i].naturalName;return b}function k(b){for(i=0;i<a.length;i++)if(a[i].naturalName==b)return a[i]}var l=new Parser;this.getPossibleCompletedQueries=function(a){return l.isLastTokenAttributeName(a)?b(a):c(a)},this.complete=function(a,b){var c="",d=l.splitConditions(a),e=l.getLastConditionCurrentlyTyped(a);if(null!==d){var f=d.length;for(d[f-1]==e&&(f-=1),i=0;i<f;i++)c+=d[i]+" "}var j="";return j=l.isLastTokenAttributeName(a)?c+b.label+":":e.indexOf(",")>0?h(c,e,b):g(c,e,b)}},Converter=function(a,b,c){function d(a){return a.match(p.buildConditionRegExp(p.SIMPLE_EQUAL_PATTERN))?e(a):a.match(p.buildConditionRegExp(p.EQUAL_WITH_WHITE_SPACE_PATTERN))?m(a):a.match(p.buildConditionRegExp(p.MULTI_VALUE_PATTERN))?l(a):a.match(p.buildConditionRegExp(p.GREATER_OR_EQUAL_PATTERN))?f(a):a.match(p.buildConditionRegExp(p.LOWER_OR_EQUAL_PATTERN))?g(a):a.match(p.buildConditionRegExp(p.RANGE_PATTERN))?n(a):void 0}function e(a){return h(a,":",o.getEqualRestToken())}function f(a){return h(a,">",o.getGreaterOrEqualRestToken())}function g(a){return h(a,"<",o.getLowerOrEqualRestToken())}function h(a,b,c){var d=a.indexOf(b),e=a.substring(0,d),f=a.substring(d+1),g=k(e,f);return e+c+g}function j(a){if(void 0===b||null===b)return null;for(i=0;i<b.length;i++)if(b[i].naturalName==a)return b[i]}function k(a,b){var c,d=j(a);if(void 0===d||null===d)c=b;else if(d.mappedValues)for(i=0;i<d.possibleValues.length;i++)d.possibleValues[i].value==b&&(c=d.possibleValues[i].key);else c=b;return o.getStringDelimiterRestToken()+c+o.getStringDelimiterRestToken()}function l(a){for(var b=a.indexOf(":"),c=a.substring(0,b),d=a.substring(b+1).split(","),e=o.getLeftParenthesisRestToken(),f=0;f<d.length;f++){var g,h=c+":"+d[f];g=h.match(p.buildConditionRegExp(p.EQUAL_WITH_WHITE_SPACE_PATTERN))?d[f].substring(1,d[f].length-1):d[f],f>0&&(e+=o.getOrRestToken()),e+=c+o.getEqualRestToken()+o.getStringDelimiterRestToken()+g+o.getStringDelimiterRestToken()}return e+=o.getRightParenthesisRestToken()}function m(a){var b=a.indexOf(":"),c=a.substring(0,b),d=a.substring(b+2);d=d.substring(0,d.length-1);var e=c+o.getEqualRestToken()+k(c,d);return e}function n(a){var b=a.indexOf(":"),c=a.substring(0,b),d=a.substring(b+2);d=d.substring(0,d.length-1);var e=d.split(" "),f=c+o.getGreaterOrEqualRestToken()+o.getStringDelimiterRestToken()+e[0]+o.getStringDelimiterRestToken()+o.getAndRestToken()+c+o.getLowerOrEqualRestToken()+o.getStringDelimiterRestToken()+e[1]+o.getStringDelimiterRestToken();return f}c=void 0===c?ODATA:c;var o=new RestTokenBuilder(c),p=new Parser;this.convert=function(){var b=$(a).val();return this.convertNaturalQuery(b)},this.convertNaturalQuery=function(a){for(var b=p.splitConditions(a),c="",e=0;e<b.length;e++)c=0===e?d(b[e]):c+o.getAndRestToken()+d(b[e]);return c}},NaturalQuery=function(a,b,c){return new NaturalQueryProcessor(a,b,c)},NaturalQueryProcessor=function(a,b,c){function d(a,b){console.log("typed data = "+a.term),possibleValues=f.getPossibleCompletedQueries(a.term),b(possibleValues)}function e(b,c){var d=f.complete(this.value,c.item);return $(a).val(d),!1}var f=new Completer(b);this.process=function(){var f=d,g=e;return $(function(){$(a).autocomplete({position:{my:"right top",at:"right bottom"},source:f,select:g,focus:function(){return!1}})}),new Converter(a,b,c)}},Parser=function(){this.SIMPLE_EQUAL_PATTERN='(\\w+):([^,\\"\\[\\] ]+)',this.GREATER_OR_EQUAL_PATTERN='(\\w+)>([^,\\"\\[\\] ]+)',this.LOWER_OR_EQUAL_PATTERN='(\\w+)<([^,\\"\\[\\] ]+)',this.MULTI_VALUE_PATTERN='(\\w+):(([^,\\"\\[\\] ]+)|(\\"[^\\"]+\\"))((,(([^,\\"\\[\\] ]*)|(\\"[^\\"]+\\")*)+)*)',this.EQUAL_WITH_WHITE_SPACE_PATTERN='(\\w+):(\\"[^\\"]+\\")',this.RANGE_PATTERN="(\\w+):(\\[[^\\[\\]]+\\])",this.buildNaturalQueryRegExp=function(){return new RegExp("("+this.MULTI_VALUE_PATTERN+")|("+this.SIMPLE_EQUAL_PATTERN+")|("+this.GREATER_OR_EQUAL_PATTERN+")|("+this.LOWER_OR_EQUAL_PATTERN+")|("+this.EQUAL_WITH_WHITE_SPACE_PATTERN+")|("+this.RANGE_PATTERN+")","g")},this.buildConditionRegExp=function(a){return new RegExp("^"+a+"$","g")},this.splitConditions=function(a){var b=this.buildNaturalQueryRegExp(),c=a.match(b);return c},this.isLastTokenAttributeName=function(a){var b=this.getLastConditionCurrentlyTyped(a);return!b.match(/(.+):(.*)/)},this.getLastConditionCurrentlyTyped=function(a){var b=this.splitConditions(a),c=a;if(null!==b)for(i=0;i<b.length;i++)c=c.replace(/^\s+/,""),c=c.replace(b[i],"");return"undefined"!==c&&""!==c||null===b||(c=b[b.length-1]),void 0===c?c:c.trim()}};const ODATA="ODATA",FIQL="FIQL";var RestTokenBuilder=function(a){this.getEqualRestToken=function(){switch(a){case ODATA:return" eq ";case FIQL:return"=="}return null},this.getGreaterOrEqualRestToken=function(){switch(a){case ODATA:return" ge ";case FIQL:return"=ge="}return null},this.getLowerOrEqualRestToken=function(){switch(a){case ODATA:return" le ";case FIQL:return"=le="}return null},this.getAndRestToken=function(){switch(a){case ODATA:return" and ";case FIQL:return";"}return null},this.getOrRestToken=function(){switch(a){case ODATA:return" or ";case FIQL:return","}return null},this.getStringDelimiterRestToken=function(){switch(a){case ODATA:return"'";case FIQL:return""}return null},this.getLeftParenthesisRestToken=function(){switch(a){case ODATA:return"( ";case FIQL:return"("}return null},this.getRightParenthesisRestToken=function(){switch(a){case ODATA:return" )";case FIQL:return")"}return null}};
//# sourceMappingURL=lucene-like-query-for-rest.min.js.map